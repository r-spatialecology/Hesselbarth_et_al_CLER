---
title: Open source landscape ecology tools
# subtitle: Do you have a subtitle? If so, write it here
# titlerunning: Open source landscape ecology tools
# authorrunning: Short form of author list if too long for running head
thanks: | 
    Grants or other notes about the article that should go on the front 
    page should be placed here. General acknowledgments should be placed at the
    end of the article.
authors: 
- name: Maximillian H.K. Hesselbarth
  address: Department of Ecosystem Modelling, University of Goettingen, Buesgenweg 4, 37077 Goettingen, Germany
  email: mhk.hesselbarth@gmail.com
- name: Jakub Nowosad
  address: Institute of Geoecology and Geoinformation, Adam Mickiewicz University, Krygowskiego 10, 61-680 Poznan, Poland
  email: nowosad.jakub@gmail.com
- name: ...
  address: ...
  email: ...
keywords:
- keyword 1
- keyword 2
- keyword 3
- keyword 4
- ...
abstract: |
  max. (200 words) Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract Abstract
bibliography: bibliography.bib
bibstyle: spphys # bibstyle options spbasic(default), spphys, spmpsci
preamble: | 
  \usepackage{caption}
  \usepackage{tabularx}
  \usepackage{multirow}
  \usepackage{placeins}
output:
  bookdown::pdf_book:
    base_format: rticles::springer_article
    number_sections: yes
    citation_package: default
editor_options: 
  chunk_output_type: console
  markdown: 
    wrap: sentence
---

```{r setup R, include = FALSE}
# load packages
library(dplyr)
library(forcats)
library(ggplot2)
library(googlesheets4)
library(knitr)
library(patchwork)
library(stringr)
library(tibble)
library(tidyr)

# MAKE SURE TO RUN R/get_survey_data.R TO GET NEWST SURVERY RESULTS

results <- readRDS("data/results.rds")

answers <- results$answers

old_names <- results$old_names

new_names <- results$new_names

base_size <- 7.5
```

# Introduction {#sec:intro}

<!-- MH: We really need to make sure, we introduce all technical terms well enough throughout the paper -->

## A short introduction to landscape ecology {#sec:landscape_ecology}

Landscape ecology focuses on how ecological processes are influenced and modified by the heterogeneous landscapes they occur in and simultaneously how the ecological processes themselves influence the landscapes \cite{Turner1989,Turner2005,With2019}.
In this context, landscape ecology considers, besides others, i) spatial and temporal dynamics of heterogeneous landscapes, ii) interactions, fluxes and exchange within these landscapes, iii) how the landscapes influence ecological processes (and vice versa), and lastly iv) how to manage these heterogeneous landscapes \cite{Risser1984,Turner1989}.

While human activities have altered the landscapes for millenniums \cite{Ellis2011,Ellis2015}, in the past centuries the effects of humans on landscapes have increased to an unknown high, known as the the Anthropocene \cite{Crutzen2002}.
Today, almost all landscapes are directly or indirectly influenced by human activities \cite{Vitousek1997}.
Thus, understanding the complex interactions between landscapes and ecological processes becomes increasingly important \cite{With2019}.

Because landscapes are defined as mosaics of different land covers, ecosystems, habitat types, or land uses \cite{Forman1986,Forman1995,Wiens1995}, spatial context is important and ecological processes will vary spatially \cite{With2019}.
To this, the importance of scale was already raised decades ago \cite{Wiens1989,Levin1992,Jelinski1996} and is still of relevance until today \cite{Simova2012,Estes2018}.
Thus, in contrast to many other sub-disciplines of ecology, landscape ecology emphasizes especially spatial patterns to a high degree \cite{Risser1984}.
Consequently, the field of landscape ecology relies on software to preprocess, modify, model, analyze, and visualize spatial data.

## Open-source software and *R* {#sec:open_source}

Software to manage and analyze data becomes increasingly important in modern scientific research \cite{Wilson2014} and many scientific studies would not have been possible without open-source software \cite{Prlic2012}.
Open-source software includes all software which is released under licenses that allow to freely use, modify and distribute the software \cite{St.Laurent2008}.
Open-source software development has many advantages, such as fast innovation, transparency, and reliability as well as longevity, mainly due to many diverse contributors \cite{vonKrogh2006,St.Laurent2008}.
Additionally, the use of open-source software facilitates (computational) reproducibility and can allow a better understanding of the used methodology of a study \cite{Prlic2012,Powers2019}.
Furthermore, open-source software allows other scientists to reuse code and not "reinvent the wheel" \cite{Prlic2012} by customizing existing software to their specific needs \cite{Steiniger2009}.
Last but not least, even though not strictly necessary by definition \cite{Steiniger2009,Steiniger2009a}, most open-source software is also free-of-cost which allows to use the software without any costs in contrast to often expensive proprietary software \cite{vonKrogh2006,Steiniger2009,Steiniger2009a}.

One successful example of an open-source project is the *R* programming language and its extensions (also called packages) \cite{RCoreTeam2019}.
Firstly introduced in 1995 \cite{Smith2016}, today the programming language is among the most popular programming languages, especially in ecology \cite{Lai2019}.
Originally introduced as a statistical programming language, a growing body of packages designed to analyze spatial data subsequently emerged for the *R* programming language \cite{Bivand2006}.
This is documented by the growing *CRAN Task Views: Analysis of Spatial Data* \cite{Bivand2019a} and *Handling and Analyzing Spatio-Temporal Data* \cite{Pebesma2020} that currently list almost 300 packages in total.
Since the task views are maintained manually by just a few people, the actual amount of *R* packages related to spatial data is most likely even higher.
The growing popularity of the *R* programming language for spatial data analysis and landscape ecology can also be seen by the increasing number of related textbooks \cite{Fletcher2019,Lovelace2019,Pebesma2019a}.

The growing body of *R* packages related to spatial data processing and analyzing results in a high capability of the *R* programming language for landscape ecology.
Even though many other open-source tools for landscape ecology exist \cite{QGISDevelopmentTeam2016,GRASSDevelopmentTeam2017,Porta2017}, in this review we are going to focus on software implemented in the *R* programming language.
For more general overviews of open-source software for landscape ecology see e.g. \cite{Jolma2008,Steiniger2009,Steiniger2009a,Istvan2012}.
Because additionally to handling spatial data, also further tasks such as statistical modeling, preparation of publication-ready figures and even preparation of complete reports can be done in the same working environment (Fig. \@ref(fig:fig-workflow)), the *R* programming language can be a very powerful tool.
Thus, in the first part we present an overview over existing *R* packages for landscape ecology (Table \@ref(tab:packages)).
In the second part, we present a survey in which we asked the community how they currently use the *R* programming language and to identify topics for which *R* packages are currently missing for landscape ecology.

# Existing packages {#sec:existing_packages}

Since most *R* packages are developed and maintained by the community, this shows how open-source software development can facilitate innovation, reproducibility and reuse of code.
There are two major online platforms to host *R* packages and make them accessible to potential users.
Firstly, *GitHub* allows to host source code under version control and users can install packages with one line using the *remotes* \cite{Hester2020} package.
Additionally, hosting the package on *GitHub* provides many useful features to collaborate and communicate between developers as well as users \cite{Wickham2015}, or integrated unit testing.
Secondly, the *Comprehensive R Archive Network* (*CRAN*) provides a large visibility to the community, ease of installation and a technical quality standard, including checks for common problems on all major operating systems.
\cite{Wickham2015}.
For developers, the guaranteed technical quality standard on *CRAN* requires more initial work for compared to *GitHub*, while it ensures for users that the package can be installed on their machine.
Additionally, the technical quality standard on *CRAN* also facilitates reproducibility and reuse of code, as shown by many reverse dependencies of *R* packages, i.e. package *x* requires and uses code from package *y* \cite{vonKrogh2006,St.Laurent2008,Steiniger2009,Prlic2012,Powers2019}.
Thus, most packages can be found on both platforms and many developers use *GitHub* for daily developing and *CRAN* to publish stable releases of the packages.
For more information about *R* package development, see \cite{Wickham2015}.

```{r fig-workflow, echo = FALSE, out.width="100%", out.height="30%", fig.cap = "Exemplary worklow of spatial data analyses for landscape ecology using the R programming language. For all major tasks, a few example R packages are listed. Of course, many more packages for the specific tasks exist."}
include_graphics("data/Workflow.png")
```

## Spatial data representations {#sec:spatrep}

While *R* has several build-in data structures, including vectors, matrices or lists, the base *R* programming language has no internal support for reading, processing, or visualizing spatial data.
However, because there is a notable interest in spatial data analysis, support for spatial data is provided by many *R* packages (\cite{Lovelace2019}, page 10).
Most spatial data belong to one of two contrasting data models, namely spatial raster and spatial vectors, and both data models have several implementations in the *R* language.
Importantly, basically all *R* packages for spatial data use the external *GDAL* and *PROJ* libraries, which allow for e.g. reading and writing of hundreds of spatial data formats, and coordinates transformation.
Additionally, *R*, *GDAL* and *PROJ* allow to convert between data models and specific implementations, which can be useful if given methods only exist for a specific data model or implementation.

In the raster data model, surfaces are divided into cells, where each cell stores a numeric value.
The values could represent discrete phenomena, such as a class number of a land cover category, or continuous phenomena, such as elevation values.
The probably most prominent package allowing for raster data representation is *raster* \cite{Hijmans2019}.
A *raster* successor aimed at the simpler interface and improved performance, *terra*, is now being developed \cite{R-terra}, however, it could take several years for this package to be adopted by users.
Alternatively, the *stars* package can be used to read and process raster data with a focus on spatial-temporal data cubes \cite{Pebesma2019}.
Additionally, there are packages that improve some basics raster operations in terms of computational performance or compatibility between raster and vector operations, such as *fasterize* \cite{Ross2020}, *rasterDT* \cite{OBrien2020}, or *exactextractr* \cite{Baston2020}.

The vector data model consists of two main elements i) geometries, such as points, lines, polygons, and ii) attributes and each geometry is connected to a value in an attribute table.
In many cases, this data model allows a more natural representation of landscape features, however, with the cost of higher computational demands <!--(add reference)-->.
The *sp* package was the standard for vector data representation for more than 10 years \cite{Pebesma2005,Bivand2013}.
As of 2020, more than 500 *R* packages directly depend or imports *sp*.
However, more recently *sp* will only be maintained (and not actively developed any more), and the recommended successor is the improved *sf* package \cite{Pebesma2018}.

<!-- JN: terra new vector representations -->

<!-- MH: I probably would not add terra here. As far as I see it, the vector support in terra is basically just support to combine vector with raster data. The main focus of the package is raster data though -->

## Spatial data download

Nowadays, spatial data for many spatial scales is available from an abundance of online accessible sources.
A lot of this data is publicly available, either as a direct download or through an API connection, and this can be used by several packages to download the spatial data directly into a *R* session.
Since public available data is becoming more and more prominent, so are *R* packages to accesses them. Packages include *rnaturalearth* \cite{South2017} to access the Natural Earth database, the *elevatr* package to access raster elevation data \cite{R-elevatr}, the *rgbif* to access the Global Biodiversity Information Facility (GBIF) portal \cite{R-rgbif}, the *BIEN* package \cite{Maitner2020} to access the Botanical Information and Ecology Network Database, the *marmap* to download bathymetry data from the ETOPO1 database \cite{Pante2013}, or the *FedData* package \cite{R-FedData} to access the National Land Cover Database (NLCD) data for the USA.
Furthermore, the *getlandsat* package \cite{Chamberlain2018} allows to download data from the Landsat 8, while the *MODIS* package \cite{Mattiuzzi2020} allows to download MODIS products.
Also, the `get_data()` function from the *raster* package allows to download climatic and bioclimatic data from WorldClim v1.4 (for WorldClim v2, see the  in-development package *geodata* <!--(add reference)-->).
Additionally, the *rgee* package \cite{R-rgee} gives access to an extensive catalog of data from Google Earth Engine, including climate data, land cover maps, and satellite imagery.

<!-- JN: how to cite (or maybe we should just add a link to?) - https://github.com/tilezen/joerd/blob/master/docs/data-sources.md -->

<!-- MH: I dont really get it. For which package do we need this link? -->

## Spatial data processing

Coordinate references systems (CRS) describe how spatial data is projected from the earth's three-dimensional surface to a two-dimensional surface as required for spatial analysis or creating maps <!-- (add reference) -->.
This is also referred to as the projection of the data and is often a first barrier in spatial data analysis.
It is not only required to have all of the used data in the same projection, but also selection of a proper projection is crucial.
This is of importance because the projection into a two-dimensional surface unavoidable leads to distortion and different CRS are optimized for different regions of the world and scales <!-- (add reference) -->.
Coordinates in spatial data can represent one of many coordinate reference systems.
Two main groups of CRS exist, namely geographical and projected, each having many members.
In the first one, geographical, positions are specified by latitude and longitude coordinates in degrees.
However, in most landscape ecology studies, projected CRSs, which use some measurement units (e.g., meters), should be utilized.
Selected projected CRS should be based on projection that keeps important properties of spatial data intact (e.g., does not distort areas, shapes, distances, angles) and be appropriate for a given study area.
Tools to find an appropriate CRS for a certain region can be found at <https://spatialreference.org>, <https://epsg.org>, or <http://epsg.io>.
In used data have different CRS, all packages from Section \@ref(sec:spatrep) have interfaces for coordinates transformations.

A second common spatial data processing task is required when the available data extends over a larger area than the study region.
In this case, the pre-processing of spatial data can include vector clipping or raster cropping.
Related to that, also masking of certain areas of the study region can be required by using e.g. certain spatial filters such as water bodies.
Packages from Section \@ref(sec:spatrep) also allow for these operations.
Additionally, they offer many other operations, such as merging or joining of spatial data, extraction of values from one dataset into another, raster resolution changes, or vector data simplifications.
A comprehensive collection of methods to aggregate raster values to a coarser resolution can also be found in the *grainchanger* package \cite{Graham2019}.
Furthermore, *landscapetools* is a collection of various utility functions for the raster data model.

Finally, there is a number of tools for landscape ecology implemented in GIS software, such as r.li or r.pi for GRASS GIS \cite{wegmann2018r,neteler2012grass,Porta2017}, terrain analysis methods in SAGA GIS \cite{gmd-8-1991-2015}, or morphological operations for Google Earth Engine.<!--https://github.com/r-spatial/rgee/blob/examples/image/morphological_operations.R--> Gladly, it is possible to control several GIS software directly from R using dedicated packages, such as *rgrass7* \cite{R-grass7} for GRASS GIS, *RSAGA* \cite{R-RSAGA} for SAGA GIS, and *rgee* \cite{R-rgee} for Google Earth Engine.

<!--JN: should we mention ArcGIS here and some of its modules?-->
<!-- MH: I don't think this is really important -->

<!--JN: in the same vain as above: should we mention Google Earth Engine?-->
<!-- MH: Again, I dont think thats really of relevance. I think as it is now its ok  -->

## Creating maps

Creating maps is essential when working with spatial data.
It has a role in checking the spatial and value-related quality of data, data exploration, and finally communicating results.
*R* allows to create two major types of maps.
Firstly, static maps in which the developer has full control over the presentation of the map and secondly, interactive maps in which the user has the possibility to modify the map by e.g. changing the displayed values.
All packages listed in Section \@ref(sec:spatrep) have build-in methods for plotting spatial data using the generic `plot()` function.
However, the generic functions are focused on quick visual inspection of the data, rather than the creating complete maps.
Advanced plotting methods for raster objects can be found in the *rasterVis* package \cite{Lamigueiro2020}.
Alternatively, the *mapview* package can be used for quick interactive visualization of spatial data \cite{R-mapview}.
The *tmap* package provides a coherent plotting system for static and interactive maps that is based on the layered grammar of graphics \cite{Tennekes2018} and aims for creating publication-ready maps.
Both, *tmap* and *mapview* build upon the *leaflet* package and leaflet javascript library \cite{R-leaflet}.
Thematic maps, including besides others proportional symbols, chroropleth, or typology, can be created with the *cartography* package \cite{Giraud2016}.
Also the popular plotting package *ggplot2* \cite{Wickham2016a} has an extension especially designed for plotting spatial data named *ggspatial* \cite{R-ggspatial}.

A slightly different approach of visualizing spatial data is the *rayshader* package \cite{Morgen-Wall2020} which allows to create topographical 2D and 3D maps.

## Ecological analysis {#sec:ecological_analysis}

#### Quantify landscape characteristics {#sec:landscape_metrics}

One of the most fundamental steps of landscape ecology is to describe and quantify landscape characteristics \cite{Turner2005,Lausch2015}.
For discrete land cover classes the composition (number and abundance) and configuration (spatial arrangement) of the landscape is often described using landscape metrics \cite{Gustafson1998,Uuemaa2009,Uuemaa2013,Gustafson2019}.
These metrics allow to compare different landscapes, quantify temporal and spatial landscape changes and investigate interactions between landscape characteristics and ecological processes \cite{Uuemaa2009}.

The use of landscape metrics was heavily facilitated by the introduction of the *FRAGSTATS* software \cite{McGarigal2012}, firstly published in 1995 \cite{Kupfer2012,Gustafson2019}.
However, *FRAGSTATS* is not open-source software (however it is free to download at the developers' homepage), which restricts transparency, reproducibility, and extensibility.
To provide a truly open-source solution to calculate landscape metrics, recently the *landscapemetrics* package \cite{Hesselbarth2019a} was developed.
The package allows to calculate the most widely used landscape metrics in a transparent and reproducible workflow within the *R* environment.
Additionally, the *belg* packages allows to calculate the Boltzmann entropy of a landscape gradient \cite{R-belgpaper}.

More recently, surface metrics were suggested as an alternative to landscape metrics for continuous raster data \cite{McGarigal2009}. The *geodiv* package \cite{Smith2020} allows to gradient surface metrics to characterize continuous analysis of landscape features. 

Most of landscape metrics are a single number depicting specific characteristics of a local landscape.
Another possibility is to derive spatial signatures - a multi-value representation of landscape composition and configuration, such as a co-occurrence histogram.
Spatial signatures calculated for many landscapes can be compared using one of the existing distance measures.
This enables several types of spatial analysis on categorical raster data, such as searching for similar landscapes, detecting changes between landscape patterns, and spatial clustering of landscapes based on their composition and configuration.
Methods for pattern-based spatial analysis are implemented in the *motif* package \cite{R-motif}.

#### Species distribution modeling {#sec:SDM}

Species distribution modeling (SDM) analysis how landscape patterns (e.g. habitat suitability, resources availability, etc.) influence and determine the patterns of species distribution, mainly to infer ecological processes and predict future species distributions \cite{Wiersma2011}.
Originated in the 1970s, SDM has experienced numerous methodological advancement and a numerous body of literature exists today \cite{Zimmermann2010}.
Additionally, textbooks introducing basic concepts of SDM in *R* exists \cite{Guisan2017,Fletcher2019}.

Because the used modeling approaches are diverse \cite{Hooten2011,Kerr2011,Fletcher2019}, there is also a large number of *R* packages used for SDMs.
Popular approaches and packages include generalized linear models using, e.g., the *stats* \cite{RCoreTeam2019} package; generalized additive models using, e.g., the *mgcv* \cite{Wood2017} or *lme4* \cite{Bates2015} package; classification and regression trees (CART) using, e.g., the *rpart* \cite{Therneau2019}, *randomForest* \cite{Liaw2002} or *ranger* \cite{Wright2017} package or multivariate data analysis using , e.g., the *ade4* \cite{Dray2007} or *vegan* \cite{Oksanen2019} package.
Of course, also packages specifically designed for SDM exists.
This includes the *dismo* \cite{Hijmans2017}, *sdm* \cite{Naimi2016}, *ecospat* \cite{Broennimann2020}, *biomod2* \cite{Thuiller2020}, *PresenceAbsence* \cite{Freeman2008} or *zoon* \cite{Golding2018} packages.
Related to SDM, there are several packages to estimate home ranges and habitat selection, including *adehabitatHR* and *adehabitatHS* \cite{Calenge2006} or *amt \cite{Signer2019}*

<!-- Another widely used SDM approach uses the concept of maximum entropy \cite{Phillips2006,Fletcher2019}. However, currently the *maxent* package is not available on *CRAN* anymore. -->

#### Connectivity {#sec:connectivity}

Connectivity is one of the core elements of landscape structure \cite{Taylor1993} and thus one of the core concepts of landscape ecology \cite{With2019}.
Landscape connectivity describes how landscape characteristics facilitate or hinder the movement of species \cite{Tischendorf2000} or other aspects of mobility, such as dispersal, gene or nutrient flow \cite{With2019}.
While structural connectivity focuses only on landscape characteristics (e.g., movement corridors, barriers), functional connectivity also includes behavior characteristics of the species \cite{Tischendorf2000,With2019}.
Given its wide concept, many different measures of connectivity exists \cite{Kindlmann2008}.
On patch level structural connectivity can be measured using nearest-neighbor distances or characterizations of the patch neighborhood (e.g. amount of suitable habitat) \cite{Kindlmann2008,With2019}.
Such measures are provided within the *landscapemetrics* package (see \ref{sec:landscape_metrics}).
Furthermore, the *lconnect* package \cite{Mestre2019} and *Makurhini* package \cite{Godinez-Gomez2020} provide several landscape connectivity metrics.
Another way to describe connectivity is based on graph theory with the advantages that also functional connectivity can be included \cite{Kindlmann2008}.
In graph theory \cite{Laita2011} landscapes are described by nodes (i.e. habitat patches) connected by and functional connections called links \cite{Laita2011}.
The *grainscape* package \cite{Chubaty2020} provides a tool to model connectivity based on spatially explicit networks.
More general, the *igraph* packages \cite{Csardi2006} provides functionality related to graph theory.
Resistance surfaces and least-cost paths are another tool to model functional connectivity.
The resistance surface describes effects of facilitating or hindering characteristics of the landscape for an organism moving within it \cite{Adriaensen2003}.
Least-cost paths can be calculated using the *gdistance* package \cite{vanEtten2017}.
Absorbing Markov chains that combines random walk theory and mortality based on the landscape characteristics \cite{Fletcher2019a} and is provided by the recently published *samc* package \cite{Marx2020}.


#### Landscape genetics {#sec:landscape_genetics}

Landscape genetics investigates how characteristics of landscapes interact with gene flow, genetic drift and selection \cite{Manel2003}.
Such insights improve our understanding of metapopulation dynamics, speciation, species' distributions and conservation \cite{Storfer2007}.
By explicitly including characteristics of landscape, landscape genetics is a way more realistic way of analysis than, e.g., metapopulation genetics \cite{Holderegger2006}.
As a result of its interdisciplinary, landscape genetics combines methods from different disciplines including landscape ecology, spatial statistics, geography and population genetics \cite{Storfer2007}.

Since describing connectivity between two locations is one of the fundamental steps of landscape genetics, all packages useful for connectivity (see \ref{sec:landscape_genetics}) are also of importance for landscape genetics.
Further functionality for landscape genetics can be found in the *graphs4lg* \cite{Savary2020}, *PopGenReport* \cite{Adamack2014,Gruber2015}, *HierDpart* packages \cite{Qin2019}, or *GeNetIt* \cite{Murphy2010}.

#### Neutral landscape models {#sec:NLM}

Neutral landscape models are used to create structured landscapes in the absence of specific ecological and landscape processes as null models against which hypotheses including specific ecological and landscape processes can be tested statistically \cite{Gardner1987,With1997}.
Because neutral landscape models are not based on ecological and landscape process, many different generic algorithms to create landscapes can be found across many different *R* packages.
A comprehensive collections of algorithms to simulate neutral landscape models specifically designed for landscape ecology can be found in the *NLMR* package \cite{Sciaini2018}.
Furthermore, the *RandomFields* package \cite{Schlather2015} allows to simulate Gaussian fields which could be used as neutral landscape models.

#### Various

<!-- MH: What about spatial autocorrelation? -->

<!-- MH: SpatialKDE, geoR, gstat, spdep, siland -->

```{=tex}
\begin{table}

\caption{Overview of commonly used R packages for landscape ecology. Packages are sorted by their major application task. Only packages focused on spatial data and landscape ecology are included.}

\begin{tabularx}{\textwidth}{X r r }

\hline
Task & R package & Reference \\
\hline
\multirow{8}{*}{Spatial data} & raster & \cite{Hijmans2019} \\
& terra & \cite{R-terra} \\
& stars & \cite{Pebesma2019} \\
& fasterize & \cite{Ross2020} \\
& rasterDT & \cite{OBrien2020} \\
& exactextractr & \cite{Baston2020} \\
& sp & \cite{Pebesma2005,Bivand2013} \\
& sf & \cite{Pebesma2018} \\
\hline
\multirow{6}{*}{Spatial data download} & rnaturalearth & \cite{South2017} \\
& elevatr & \cite{R-elevatr} \\
& rgbif & \cite{R-rgbif} \\
& BIEN & \cite{Maitner2020} \\
& marmap & \cite{Pante2013} \\
& FedData & \cite{R-FedData} \\
& getlandsat & \cite{Chamberlain2018} \\
& MODIS & \cite{Mattiuzzi2020} \\
\hline
\multirow{7}{*}{Creating maps} & rasterVis & \cite{Lamigueiro2020} \\
& mapview & \cite{R-mapview} \\
& tmap & \cite{Tennekes2018} \\
& leaflet & \cite{R-leaflet} \\
& cartography & \cite{Giraud2016} \\
& ggspatial & \cite{Dunnington2020} \\
& rayshader & \cite{Morgen-Wall2020} \\
\hline
\multirow{4}{*}{\shortstack[l]{Quantifying landscape\\characteristics}} & landscapemetrics & \cite{Hesselbarth2019a} \\
& belg &  \cite{R-belgpaper} \\
& motif & \cite{R-motif} \\
& geodiv & \cite{Smith2020} \\
\hline
\multirow{8}{*}{\shortstack[l]{Species distribution\\modeling}} & dismo & \cite{Hijmans2017} \\
& sdm & \cite{Naimi2016} \\
& ecospat & \cite{Broennimann2020} \\
& biomod2 & \cite{Thuiller2020} \\
& PresenceAbsence & \cite{Freeman2008} \\
& zoon & \cite{Golding2018} \\
& adehabitatHR, adehabitatHS & \cite{Calenge2006} \\
& amt & \cite{Signer2019} \\
\hline
\multirow{5}{*}{Connectivity} & lconnect & \cite{Mestre2019} \\
& Makurhini & \cite{Godinez-Gomez2020} \\
& grainscape & \cite{Chubaty2020} \\
& gdistance & \cite{vanEtten2017} \\
& samc & \cite{Marx2020} \\
\hline
\multirow{4}{*}{Landscape genetics} & raphs4lg & \cite{Savary2020} \\
& PopGenReport & \cite{Adamack2014,Gruber2015} \\
& HierDpart & \cite{Qin2019} \\
& GeNetIt & \cite{Murphy2010} \\
\hline
\multirow{4}{*}{various} & NLMR & \cite{Sciaini2018} \\
& RandomFields & \cite{Schlather2015} \\
& landscapetools & \cite{Sciaini2018}  \\
& grainchanger & \cite{Graham2019} \\
\hline

\end{tabularx}

\label{tab:packages}

\end{table}
```
# Survey of R usage by landscape ecology community

```{r participation, include = FALSE}
digits <- 1

# number of people that took part
n_people <- nrow(answers)

# current position
current_position <- dplyr::group_by(answers, position) %>% 
  dplyr::summarise(n_rel = n() / n_people * 100) %>% 
  dplyr::mutate(n_rel = round(n_rel, digits = digits)) %>% 
  dplyr::arrange(-n_rel)
  
# how often do you use R?
usage_freq <- dplyr::group_by(answers, usage_freq) %>% 
  dplyr::summarise(n_rel = n() / n_people * 100) %>% 
  dplyr::mutate(n_rel = round(n_rel, digits = digits)) %>% 
  dplyr::arrange(-n_rel)

# expertise
expertise <- dplyr::group_by(answers, expertise) %>% 
  dplyr::summarise(n_rel = n() / n_people * 100) %>% 
  dplyr::mutate(n_rel = round(n_rel, digits = digits)) %>% 
  dplyr::arrange(-n_rel)

# own package
own_package <- dplyr::group_by(answers, own_package) %>% 
  dplyr::summarise(n_rel = n() / n_people * 100) %>% 
  dplyr::mutate(n_rel = round(n_rel, digits = digits)) %>% 
  dplyr::arrange(-n_rel)
```

To better understand how *R* is used by the landscape ecology community, we conducted a short survey and used mailing lists and social media to reach the community.
In total, the survey was answered by `r n_people` participants, of which the the majority were either "PhD students" (`r current_position[[1, 2]]`%), followed by "Post-Docs" (`r current_position[[2, 2]]`%) and "Professors" (`r current_position[[3, 2]]`%).
Other, less frequent answers, were "Data scientists", "None of the above", "Government employees" "Master's degree student" and "Bachelor's degree student" (in decreasing order).

Most people use *R* either "daily" (`r usage_freq[[1, 2]]`%) or a "few times a week" (`r usage_freq[[2, 2]]`%).
About half of all participants described themselves as "advanced" user (`r expertise[[1, 2]]`%), while `r expertise[[2, 2]]`% described themselves as "intermediate" users.
Related to this, about half of the participants either implemented their own package (`r own_package[[3, 2]]`%) or plan to do so in the future (`r own_package[[2, 2]]`%) and most of these packages are hosted on *GitHub* and/or *CRAN*.

```{r research-topics, include = FALSE}

major_topics <- unlist(str_split(answers$major_topic, pattern = ","))

major_topics <- str_trim(major_topics)

major_topics <- str_to_lower(major_topics)

major_topics[major_topics == "-"] <- NA

topics_df <- tibble(topics = major_topics) %>%
  dplyr::group_by(topics) %>%
  dplyr::summarise(n = dplyr::n()) %>%
  dplyr::mutate(n_rel = n / sum(n) * 100,
                topics_reclass = dplyr::case_when(n >= 5 ~ topics,
                                                  n < 5 ~ "others")) %>%
  dplyr::group_by(topics_reclass) %>%
  dplyr::summarise(n_rel = sum(n_rel)) %>% 
  dplyr::mutate(label = paste0(round(n_rel, digits = 1), "%"), 
                col = dplyr::case_when(topics_reclass == "others" ~ 0, 
                                       topics_reclass != "others" ~ 1), 
                col = factor(col)) %>% 
  dplyr::arrange(-n_rel)

# change ordering
new_levels <- c("others", rev(topics_df$topics_reclass[!topics_df$topics_reclass == "others"]))

# reorder levels
topics_df$topics_reclass <- factor(topics_df$topics_reclass, levels = new_levels)

# major_topic
ggplot_topics <-  ggplot(data = topics_df) +
  geom_bar(aes(y = topics_reclass, x = n_rel, fill = col), stat = "identity") + 
  # geom_text(aes(y = topics_reclass, x = n_rel, label = label, col = col),
  #           nudge_x = 1.25, size = 2.5) +
  theme_classic(base_size = base_size) +
  theme(plot.title.position = "plot") +
  scale_x_continuous(breaks = seq(0, 20, 5), limits = c(0, 20)) + 
  scale_fill_manual(values = c("grey50", "black")) +
  scale_colour_manual(values = c("grey50", "black")) +
  guides(fill = FALSE, colour = FALSE) +
  labs(x = "Number of task mentioned [%]", y = NULL,
       title = "Which terms describe your\nmajor research topics the best?")

```

We asked the participants to select which terms describe their research topics the best and options that were selected by more than 10% of participants included "biodiversity", followed by "land use management", "landscape connectivity" and "nature conservation" (Fig. \@ref(fig:fig-survey) A)).

```{r tasks, include = FALSE}
# get data 
important_tasks <- unlist(str_split(answers$important_tasks, pattern = ","))

# remove empty space at beginning
important_tasks <- str_trim(important_tasks)

# make sure all lower case
important_tasks <- str_to_lower(important_tasks)

# shorten labels
important_tasks[important_tasks == "(pre-)processing of spatial data"] <- "(pre-)processing data"

important_tasks[important_tasks == "spatial point pattern analysis"] <- "point pattern analysis"

important_tasks[important_tasks == "programming individual based models"] <- "individual based modelling"

important_tasks[important_tasks == "creating neutral landscape models"] <- "neutral landscape models"

important_tasks[important_tasks == "quantifying landscape characteristics (e.g. landscape metrics)"] <- "quantifying landscape characteristics"

# # add line breaks
# important_tasks <- str_replace_all(important_tasks, pattern = " ", replacement = "\n")

# create data.frame
tasks_df <- tibble(tasks = important_tasks) %>%
  dplyr::group_by(tasks) %>% 
  dplyr::summarise(n = dplyr::n()) %>% 
  dplyr::mutate(n_rel = n / sum(n) * 100, 
                tasks_reclass = dplyr::case_when(n >= 5 ~ tasks, 
                                                 n < 5 ~ "others")) %>%
  dplyr::group_by(tasks_reclass) %>% 
  dplyr::summarise(n_rel = sum(n_rel)) %>% 
  dplyr::mutate(label = paste0(round(n_rel, digits = 1), "%"), 
                col = dplyr::case_when(tasks_reclass == "others" ~ 0, 
                                       tasks_reclass != "others" ~ 1), 
                col = factor(col)) %>% 
  dplyr::arrange(-n_rel)

# change ordering
new_levels <- c("others", rev(tasks_df$tasks_reclass[!tasks_df$tasks_reclass == "others"]))

# reorder levels
tasks_df$tasks_reclass <- factor(tasks_df$tasks_reclass, levels = new_levels)

ggplot_tasks <- ggplot(data = tasks_df) +
  geom_bar(aes(y = tasks_reclass, x = n_rel, fill = col), stat = "identity") + 
  # geom_text(aes(y = tasks_reclass, x = n_rel, label = label, col = col),
  #           nudge_x = 1.25, size = 2.5) +
  theme_classic(base_size = base_size) +
  theme(plot.title.position = "plot") +
  scale_x_continuous(breaks = seq(0, 20, 5), limits = c(0, 20)) + 
  scale_fill_manual(values = c("grey50", "black")) +
  scale_colour_manual(values = c("grey50", "black")) +
  guides(fill = FALSE, colour = FALSE) +
  labs(x = "Number of task mentioned [%]", y = NULL,
       title = "Which are the most important\ntasks to your workflow?")
```

Next, we were interested in the most important tasks to the workflow of the participants.
Not surprisingly, "(pre-)processing of data", "spatial statistics" and "creating maps" were the most selected options (Fig. \@ref(fig:fig-survey) B)).
Interestingly, the available options seemed to describe the most important task to the workflow quite well since only very few participants selected the "others" option (all options with less than five total answers were classified as "others").

```{r data-model, include = FALSE}
# data model
data_model <- dplyr::group_by(answers, data_model) %>% 
  dplyr::summarise(n_rel = n() / n_people * 100) %>% 
  dplyr::mutate(n_rel = round(n_rel, digits = digits)) %>% 
  dplyr::arrange(-n_rel)

```

```{r packages, include =FALSE}

# split answers r packages
r_packages <- unlist(str_split(answers$r_packages, pattern = ","))
r_packages <- unlist(str_split(r_packages, pattern = ";"))
r_packages <- unlist(str_split(r_packages, pattern = "\\*"))
r_packages <- str_trim(r_packages)

# clean some special cases
r_packages[str_detect(r_packages, pattern = "landscape metrics")] <- "landscapemetrics"
r_packages[str_detect(r_packages, pattern = "spectre*")] <- "spectre"
r_packages[str_detect(r_packages, pattern = "map tools")] <- "maptools"
r_packages[str_detect(r_packages, pattern = "gdal and many more")] <- "rgdal"
r_packages[str_detect(r_packages, pattern = "I would like to know")] <- "NA"
r_packages[str_detect(r_packages, pattern = "no")] <- "NA"
r_packages[str_detect(r_packages, pattern = "currently none")] <- "NA"
r_packages[!str_detect(r_packages, pattern = "")] <- "NA"

# split last packages
r_packages <- unlist(str_split(r_packages, pattern = " "))

# remove NA answers
r_packages <- r_packages[!str_detect(r_packages, pattern = "NA")] 

# make sure all are lower case
r_packages <- str_to_lower(r_packages)

# create data.frame
r_packages_df <- tibble(r_package = r_packages) %>%
  dplyr::group_by(r_package) %>% 
  dplyr::summarise(n = dplyr::n()) %>% 
  dplyr::mutate(n_rel = n / sum(n) * 100, 
                r_package_reclass = dplyr::case_when(n >= 5 ~ r_package, 
                                                     n < 5 ~ "others")) %>%
  dplyr::group_by(r_package_reclass) %>% 
  dplyr::summarise(n_rel = sum(n_rel)) %>% 
  dplyr::mutate(label = paste0(round(n_rel, digits = 1), "%"), 
                col = dplyr::case_when(r_package_reclass == "others" ~ 0, 
                                       r_package_reclass != "others" ~ 1), 
                col = factor(col)) %>% 
  dplyr::arrange(-n_rel) 

# change ordering
new_levels <- c("others", rev(r_packages_df$r_package_reclass[-1]))

# reorder levels
r_packages_df$r_package_reclass <- factor(r_packages_df$r_package_reclass, 
                                          levels = new_levels)

ggplot_packages <- ggplot(data = r_packages_df) +
  geom_bar(aes(y = r_package_reclass, x = n_rel, fill = col), stat = "identity") + 
  # geom_text(aes(y = r_package_reclass, x = n_rel, label = label, col = col), 
  #           nudge_x = 2, size = 2.5) + 
  theme_classic(base_size = base_size) +
  theme(plot.title.position = "plot") +
  scale_x_continuous(breaks = seq(0, 35, 5), limits = c(0, 35)) + 
  scale_fill_manual(values = c("grey50", "black")) +
  scale_colour_manual(values = c("grey50", "black")) +
  guides(fill = FALSE, colour = FALSE) +
  labs(x = "Number of package mentioned [%]", y = NULL,
       title = "List the three R packages related\nto landscape ecology you use the most")
```

Interestingly, more people use the raster data model (`r data_model[[1, 2]]`%) in comparison to the vector data model (`r data_model[[2, 2]]`%).
This was also represented in the most used *R* packages (Fig. \@ref(fig:fig-survey) C)).
When asked for the three most used packages, participants of the survey listed `r length(unique(r_packages))` packages in total.
The *raster* package was mentioned the most, followed by the *sf* package.
Both packages are designed for basic and advanced data handling and processing of raster and vector data, respectively, representing the results of Fig.
\@ref(fig:fig-survey) C).
Nevertheless, the large availability and usage of different *R* packages across the community can be seen in the large "others" option (packages mentioned by less than 5 participants; `r r_packages_df[[1, 2]]`%).

```{r usefulness, include = FALSE}
# create vector with classses

classes <- c("very useful", "useful", "intermediate", 
             "not useful", "not useful at all")

# create data.frame
usefulness_df <- dplyr::group_by(answers, usefulness) %>% 
  dplyr::summarise(n = dplyr::n()) %>% 
  dplyr::mutate(n_rel = n / sum(n) * 100) %>%
  tibble::add_row(usefulness = 1, n = 0, n_rel = 0) %>% 
  dplyr::arrange(-usefulness) %>% 
  dplyr::mutate(label = paste0(round(n_rel, digits = 1), "%"), 
                usefulness_class = classes,
                usefulness_class = factor(usefulness_class,
                                          levels = rev(classes))) %>% 
  dplyr::arrange(-n_rel)

good_eval <- dplyr::filter(usefulness_df, usefulness %in% c(5, 4)) %>% 
  dplyr::pull(n_rel) %>% 
  sum() %>% 
  round(digits = 2)

bad_eval <- dplyr::filter(usefulness_df, usefulness %in% c(3, 2, 1)) %>% 
  dplyr::pull(n_rel) %>% 
  sum() %>% 
  round(digits = 2)

ggplot_usefulness <- ggplot(data = usefulness_df) +
  geom_bar(aes(x = usefulness_class, y = n_rel), 
           stat = "identity") + 
  theme_classic(base_size = 10) +
  theme(plot.title.position = "plot") +
  scale_y_continuous(breaks = seq(0, 60, 10), limits = c(0, 60)) + 
  guides(fill = FALSE, colour = FALSE) +
  labs(x = NULL,
       title = "How useful do you think is R currently for landscape ecology?", 
       y = "Number of participants [%]")
```

Lastly, when asked how use *R* us currently for landscape ecology, the vast majority of participants answered with either "very useful" or "useful" (summarized `r good_eval`%) and only only very few participants evaluated *R* as "intermediate", "not useful" or "not useful at all" (summarized `r bad_eval`%; Fig. \@ref(fig:fig-survey) D)).

```{r fig-survey, echo = FALSE, fig.align="center", fig.cap = "Results of the online survey about open-source software tools in R for landscape ecology. Results include A) which terms describe major reserach topics the best, B) the most important workflow task, C) the most used R packages and D) the overall usefulnes or R for landscape ecology. 'others' includes all answers with less than five total mentions."}

(ggplot_topics | ggplot_tasks | ggplot_packages ) / ggplot_usefulness + 
  plot_layout(heights = c(2, 3)) +
  plot_annotation(tag_levels = "A", tag_suffix = ")")

```

The survey also included a section in which participants could list methods and tools that are currently missing in *R* and answers to this question were very diverse.

```{r comments, include = FALSE}

missing_methods <- answers$missing_methods[!is.na(answers$missing_methods)]

missing_methods <- str_to_lower(missing_methods)

# no answer, no missing packages
id_na <- c("not sure", "not sure right now",  
           "i have no additional needs for my current workflow", "none that i can think of", 
           "i would like to know", "none", "i still have to fully understand what is there", 
           "i don't know, sorry!", "r havent fail me yet", "na", 
           "i'm not missing anything at present.", "não posso responder", 
           "no", "unsure", "have not yet identified any.", "no package missing", 
           "not enough overview to answer this", "?", "i am currently missing no methods",
           ";", "nothing yet", "i'm thinking", "nil")


length(id_na) / nrow(answers) * 100

missing_methods <- missing_methods[!missing_methods %in% id_na]

# classify answers as good as possible
methods_performance <- missing_methods[c(2, 4, 8, 9, 10, 21, 23, 27, 30, 33, 41, 45, 
                                         48, 56)]

perc_performance <- round(length(methods_performance) / nrow(answers) * 100, 1)

methods_viz <- missing_methods[c(3, 7, 13, 22, 29, 33, 41, 57, 58)]

perc_viz <- round(length(methods_viz) / nrow(answers) * 100, 1)

methods_characterisation <- missing_methods[c(7, 14, 20, 24, 39, 42, 47, 51, 59, 65)]

perc_characterisation <- round(length(methods_characterisation) / nrow(answers) * 100, 1)

# methods_connectivity <- missing_methods[c(12, 17, 26, 31, 35, 36, 40, 51)]
# 
# perc_connectivity <- round(length(methods_connectivity) / nrow(answers) * 100, 1)

```

Overall, `r round(length(id_na) / nrow(answers) * 100, digits)`% of the participants reported that currently no packages and functionality are missing for them or they lack the overview to answer the question.
There were three most common topics across the answers of the participants.
Firstly, many participants (`r perc_performance`%) wished for a better computational performance of *R* in terms of speed and required RAM, especially for larger data.
Secondly, participant are missing specific approaches to quantify landscape characteristics (such as surface metrics), or are wishing for an improvement of currently available approaches to quantify landscape characteristics (`r perc_characterisation`%).
Thirdly, many participants (`r perc_viz`%) are currently missing advanced and easy-to-apply methods to create high-quality maps or other visualization-related functionality.

<!--JN: I think we should answer to some of the comments in the missing packages section: point people to some packages (if possible), mention which of the missing tools are not going to be implemented, and also forward people to methods and tools on how to improve some problems (e.g. speed and required RAM for larger data -> use of Rcpp, use external servers, or read data in chunks, etc.)-->

<!-- MH: I am not sure if we should do this explicitly here  That would somehow repeat the section we already have about the different packages. We should, however, make sure that in case we know a pacakge that answers one of the points here, is included in the first section of the papaer -->

# Conclusions

Since its first introduction in 1995, *R* has come a long way from an exclusively statistical programming language to a powerful tool for landscape ecology.
Today, many *R* packages, mainly developed by the community itself, provide a vast collection of functions and algorithms aimed for spatial data handling and analysis.
The highly dynamic development of *R* packages for landscape ecology also shows the strength of open-source software with its high innovation, transparency, reliability, and longevity.
However, since the scientific field of landscape ecology constantly develops and improves, also the *R* programming language and its packages need to change and adapt these changes.

## Acknowledgments

#### Conflict of interest

MHKH and JN are authors of the *landscapemetrics* and *landscapetools* package.
JN is author of *belg* and *motif* package.

#### Funding

MHKH was supported by the German Research Association (DFG) Research Training Group 1644 'Scaling Problems in Statistics', grant number 152112243.
<!-- MH: Add UMich Funding? -->

#### Author contributions

MHKH and JN designed the survey form and analyzed the responses of the participants.
MHKH and JN drafted the manuscript and all authors contributed critically to the manuscript and gave final approval for publication.
We used the 'sequence--determines--credit' approach (SDC) for the sequence of authors.

#### Human and Animal Rights and Informed Consent

This article does not contain any studies with human or animal subjects performed by any of the authors.
